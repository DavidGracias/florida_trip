{"filter":false,"title":"studentsOG.php","tooltip":"/studentsOG.php","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":362,"column":9},"action":"insert","lines":["<!--This page may not work, Ben is trying to fix it-->","","<?php ","    include_once(\"includes/modals/medicalInformation.php\");","    include_once(\"includes/modals/stats.php\");","    include_once(\"includes/modals/roomEdit.php\")","    // Sydney, this modal broke the page","    // haha sucker i fixed it","?>","<!----Table---->","<div style=\"overflow-x:auto\" class=\"background-white\">","    <?php if($_SESSION[\"userLevel\"] > $_userType[\"student\"]){ $nextTripYear=substr(nextTripYear($conn, true), 0, 4);","        $result=mysqli_query($conn, \"SELECT * FROM `form` WHERE `gradYear`=\".$nextTripYear);","        if(mysqli_num_rows($result) > 0){ ?>","        <div style=\"margin-bottom: 20px\" class=\"col-xs-12 col-xs-push-0 col-lg-10 col-lg-push-1\">","            <!-- Stats Table -->","            <table class=\"table\" id=\"stats\">","                    <thead>","                    <tr class=\"nowrap\">","                        <th class=\"border-right\">","                            Class <i class=\"fas fa-graduation-cap\"></i>","                        </th>","                        <th class=\"border-right\">","                            Students","                        </th>","                        <th class=\"border-right\" colspan=\"2\">","                            Forms<br/>","                            Complete / Missing","                        </th>","                        <th class=\"border-right\" colspan=\"2\">","                            Payments<br/>","                            Complete / Missing","                        </th>","                        <th class=\"border-right\" colspan=\"3\">","                            Gender<br/>","                            Male/Female/Other","                        </th>","                        <th>","                            SM<br/>","                            <i style=\"font-size: .5em\" class=\"fas fa-tshirt\"></i>","                        </th>","                        <th>","                            MD<br/>","                            <i style=\"font-size: .725em\" class=\"fas fa-tshirt\"></i>","                        </th>","                        <th>","                            LG<br/>","                            <i style=\"font-size: .825em\" class=\"fas fa-tshirt\"></i>","                        </th>","                        <th>","                            XL<br/>","                            <i style=\"font-size: 1em\" class=\"fas fa-tshirt\"></i>","                        </th>","                    </tr>","                    </thead>","                    <tr>","                        <!--CLASS-->","                        <td class=\"border-right\">","                            <?php echo $nextTripYear; ?>","                        </td>","                        <!--STUDENTS-->","                        <td class=\"border-right\">","                            <?php $students=mysqli_query($conn, \"SELECT * FROM `students` WHERE `gradYear`=\".$nextTripYear);","                            $numStudents=mysqli_num_rows($students);","                            echo $numStudents; ?>","                        </td>","                        <!--FORMS-->","                        <td style=\"padding-right: 0px\">","                            <div class=\"gender pointer green\" data-toggle=\"modal\" data-target=\"#statsModal\" data-id=\"forms\">","                                <i class=\"fas fa-check\"></i>","                                <?php $forms=mysqli_query($conn, \"SELECT * FROM `form` WHERE `gradYear`=\".$nextTripYear);","                                echo mysqli_num_rows($forms); ?>","                            </div>","","                        </td>","                        <td class=\"border-right\">","                            <div class=\"gender pointer red\" data-toggle=\"modal\" data-target=\"#statsModal\" data-id=\"forms\">","                                <i class=\"fas fa-times\"></i>","                                <?php echo $numStudents-mysqli_num_rows($forms); ?>","                            </div>","                        </td>","                        <!--PAYMENTS-->","                        <td style=\"padding-right: 0px\">","                            <div class=\"gender green pointer\" data-id=\"payments\" data-toggle=\"modal\" data-target=\"#statsModal\">","                                <i class=\"fas fa-check\"></i>","                                <?php $tripTotal=0;","                                    $trip=mysqli_query($conn, \"SELECT * FROM `trip` WHERE `gradYear`=\".$nextTripYear);","                                    if(mysqli_num_rows($trip) > 0 && $row=mysqli_fetch_assoc($trip)){","                                        $tripTotal+=$row['pay1']+$row['pay2']+$row['pay3'];","                                    }","","                                    $payments=mysqli_query($conn, \"SELECT * FROM `transactions` WHERE `gradYear`=\".$nextTripYear.' ORDER BY studID');","                                    $numPayments=0;","                                    $studID=-1;","                                    $sumTotal=0;","                                    while(mysqli_num_rows($payments) > 0 && $payRow=mysqli_fetch_assoc($payments)){","                                        if($payRow[\"studID\"] !=$studID){","                                            if($sumTotal >=$tripTotal)","                                                $numPayments+=1;","                                            $studID=$payRow[\"studID\"];","                                            $sumTotal=0;","                                        }","                                        $sumTotal+=intval($payRow[\"amount\"]);","                                    }","                                echo $numPayments; ?>","                            </div>","                        </td>","                        <td class=\"border-right\">","                            <div class=\"gender red pointer\" data-toggle=\"modal\" data-target=\"#statsModal\" data-id=\"payments\">","                                <i class=\"fas fa-times\"></i>","                                <?php echo $numStudents-$numPayments; ?>","                            </div>","                        </td>","                        <!--GENDER-->","                        <td style=\"padding-right: 0px\">","                            <div class=\"gender blue pointer\" title=\"Male\" data-id=\"gender\" data-toggle=\"modal\" data-target=\"#statsModal\">","                                <i class=\"fas fa-mars\"></i>","                                <?php $students=mysqli_query($conn, \"SELECT * FROM `students` WHERE `gradYear`=\".$nextTripYear.\" AND `gender`=0\");","                                echo mysqli_num_rows($students); ?>","                            </div>","                        </td>","                        <td class=\"padding-1\">","                            <div class=\"gender pink pointer\" title=\"Female\" data-id=\"gender\" data-toggle=\"modal\" data-target=\"#statsModal\">","                                <i class=\"fas fa-venus\"></i>","                                <?php $students=mysqli_query($conn, \"SELECT * FROM `students` WHERE `gradYear`=\".$nextTripYear.\" AND `gender`=1\");","                                echo mysqli_num_rows($students); ?>","                            </div>","                        </td>","                        <td class=\"border-right\" style=\"padding-left: 0px\">","                            <div class=\"gender yellow pointer\" title=\"Other\"  data-id=\"gender\" data-toggle=\"modal\" data-target=\"#statsModal\">","                                <i class=\"fas fa-genderless\"></i>","                                <?php $students=mysqli_query($conn, \"SELECT * FROM `students` WHERE `gradYear`=\".$nextTripYear.\" AND `gender`=2\");","                                echo mysqli_num_rows($students); ?>","                            </div>","                        </td>","                        <!--SHIRT SIZE-->","                        <td>","                            <?php $s=mysqli_query($conn, \"SELECT * FROM `form` WHERE `gradYear`=\".$nextTripYear.\" AND `shirtSize`=\\\"S\\\" \");","                            echo mysqli_num_rows($s); ?>","                        </td>","                        <td>","                            <?php $m=mysqli_query($conn, \"SELECT * FROM `form` WHERE `gradYear`=\".$nextTripYear.\" AND `shirtSize`=\\\"M\\\" \");","                            echo mysqli_num_rows($m); ?>","                        </td>","                        <td>","                            <?php $l=mysqli_query($conn, \"SELECT * FROM `form` WHERE `gradYear`=\".$nextTripYear.\" AND `shirtSize`=\\\"L\\\" \");","                            echo mysqli_num_rows($l); ?>","                        </td>","                        <td>","                            <?php $xl=mysqli_query($conn, \"SELECT * FROM `form` WHERE `gradYear`=\".$nextTripYear.\" AND `shirtSize`=\\\"XL\\\" \");","                            echo mysqli_num_rows($xl); ?>","                        </td>","                    </tr>","                </table>","        </div>","        <?php } ?>","    <?php } ?>","","    <table id=\"stuTable\" class='table table-hover'>","        <thead class=\"thead-dark\">","            <tr>","                <th>Class <i class=\"fas fa-graduation-cap\"></i></th>","                <th>Up To Date</th>","                <th>Students</th>","                <!--<th>Payed</th>-->","                <!--<th>Forms</th>-->","            </tr>","        </thead>","        <?php","            //gradYear is from trip","            //sizes are in form","            $result=mysqli_query($conn, \"SELECT * FROM `trip` WHERE NOT `gradYear`=9999\");","            while(mysqli_num_rows($result) > 0 && $row=mysqli_fetch_assoc($result)){ ?>","                <tr>","                    <td><?php echo $row[\"gradYear\"]; ?></td>","                    <td>","                        <?php","                        echo \"100%\";","                        ?>","                    </td>","                    <td>","                        <?php $students=mysqli_query($conn, \"SELECT * FROM `students` WHERE `gradYear`=\".$row[\"gradYear\"].\" ORDER BY `gradYear` DESC\");","                        echo mysqli_num_rows($students); ?>","                    </td>","                </tr>","            <?php } ?>","    </table>","</div>","<div class=\"background-white\">","    <br/>","</div>","","            <!------------------------------------------>","            <!------------------------------------------>","            <!-------------Student Table---------------->","            <!------------------------------------------>","            <!------------------------------------------>","","<div class=\"container-fluid background-pink\" id=\"students\">","    <h2 class=\"padding-2 vertical-align\">","        <div>Students</div>","        <div class=\"flex-grow input-group padding-3\">","            <input  id=\"searchBar\" class=\"form-control\" type=\"text\" placeholder=\"Search..\"/>","            <div class=\"input-group-btn\">","                <div class=\"btn btn-default\" data-type=\"slideable\" data-parent=\"4\" data-target=\"#filterStudentsDiv\">","                    <i class=\"fas fa-filter\"></i>","                </div>","            </div>","        </div>","        <button class=\"btn btn-default btn-primary\" data-toggle=\"modal\" data-target=\"#newUserModal\">","            <i class=\"fas fa-plus\"></i> New Student","        </button>","    </h2>","    <?php include_once(\"includes/filterStudents.php\"); ?>","    <div id=\"student-table-navbar\" class=\"clear\">","        <div class=\"students-link\" id=\"students-link\">","            Jump to:","            <?php ","                for($i=ord('a'); $i <=ord('z'); $i++) ","                    echo \"<a class='pointer' href='javascript: JumpTo($(\\\"#\\\"+closestLetter(\\\"\".chr($i).\"\\\")))'>\".strtoupper(chr($i)).\"</a>\"; ","            ?>","        </div>","        <br/>","","    </div>","    <?php if($_SESSION[\"userLevel\"] >=$_userType[\"sponsor\"]){","            include_once(\"includes/modals/newStudent.php\");","            include_once(\"includes/modals/studentBalance.php\");","        } ?>","    <div class=\"container-fluid\" id=\"container\" style=\"max-height: 75vh; overflow-y: scroll; overflow-x: hidden\">","        <table id='studTbl' class='table table-responsive table-students stickyHeader' style=\"margin-bottom: -5px; max-width: 100%;\">","            <thead>","                <tr>","                    <th>Name</th>","                    <th>Balance</th>","                    <th>Contract</th>","                    <th>Medical Form</th>","                    <th>Chaperone</th>","                    <th>Bus #</th>","                    <th>Roommates</th>","                </tr>","            </thead>","            <tbody class='letterHeader' style='padding-top:10px'>","            <?php $missingLetters=[];","            for($letter=ord('a'); $letter <=ord('z'); $letter++){","                $cLetter=chr($letter);","                $result=mysqli_query($conn, \"SELECT * FROM `students` WHERE `lName` LIKE '$cLetter%' ORDER BY `lName`, `fName`\");","                if(mysqli_num_rows($result) > 0){","                    echo \"<tr id='$cLetter' class='background-pink'><th colspan='99' class='color-white' style='text-align:left; background-color: rgba(255, 255, 255, .1)'>\".strtoupper($cLetter).\"</th></tr>\";                    // echo \"<div class='table-responsive'><table class='table table-hover table-students'><tbody>\";","                    $genderClass=\"\";","                    while($row=mysqli_fetch_assoc($result)){","","                        $studID=$row['studID']; ","            /*<tr>*/    echo \"<tr class='studListing' title='$studID' style='vertical-align:middle'>\";","                        ","                        $genderClass=\"fas fa-lg \";","                        if($row[\"gender\"] == 0)","                            $genderClass.=\"fa-mars color-gender-male\";","                        else if($row[\"gender\"] == 1)","                            $genderClass.=\"fa-venus color-gender-female\";","                        else","                            $genderClass.=\"fa-genderless color-gender-other\";","                            ","                        $fn=ucfirst($row['fName']); ","                        $ln=ucfirst($row['lName']); ","                        ","            /*<td>*/    echo \"<td style='text-align:left' class='studName'><i class='$genderClass'></i> $fn $ln </td>\"; ","                        $raised=$row['balance']; ","            /*<td>*/    echo \"<td><span class='a pointer' data-toggle='modal' data-target='#studentBalance' onclick='populateStudentBalanceModal($studID)'>$$raised</span></td>\"; ","                        if ($row[\"seniorTripContract\"] == 0)","                            $contract=\"<i class='fas fa-times' style='color: #FF0000'></i>\";","                        else","                            $contract=\"<i class='fas fa-check color-green'></i>\";","            /*<td>*/    echo \"<td>\".$contract.\"</td>\";","            /*<td>*/    echo \"<td>\";","                        $colorResult = mysqli_query($conn, \"SELECT * FROM `form` WHERE `studID`='\".$row[\"studID\"].\"'\");","                        $color = (mysqli_num_rows($colorResult) > 0)? \"success\" : \"danger\"; ?>","                        <button type=\"button\" class=\"btn btn-<?php echo $color; ?> btn-sm\" data-toggle=\"modal\" data-target=\"#medicalInfoModal\"><i class=\"fas fa-info-circle\"></i> Medical Info</button>","                  <?php echo \"</td>\";","                        ","            /*<td>*/    echo \"<td>\"; ","                        //$assignmentResult=mysqli_query($conn, \"SELECT * FROM assignments a INNER JOIN chaperones c ON a.chapID=c.chapID WHERE '$studID' in(a.stud1, a.stud2, a.stud3, a.stud4)\"); ","                        $assignmentResult = mysqli_query($conn, \"SELECT * FROM assignments WHERE '$studID' in(stud1, stud2, stud3, stud4)\");","                        $row = 0;","                        if(mysqli_num_rows($assignmentResult) > 0){","                            $row=mysqli_fetch_assoc($assignmentResult);","                        }","                        if(mysqli_num_rows($assignmentResult) > 0 && $row['chapID'] !== null){","                        $chapID=$row['chapID'];","                        $chapResult=mysqli_query($conn,\"SELECT * from chaperones where chapID=$chapID\");","                        $chapResult=mysqli_fetch_assoc($chapResult);","                            echo $chapResult['fName'].\" \".$chapResult['lName'];","                        }else{","                            echo \"N/A\";","                        }","                        echo \"</td>\";","            /*<td>*/    echo \"<td>\";","                        if(mysqli_num_rows($assignmentResult)>0 && $row['bus'] !== null){","                            echo $row['bus'];","                        }else{","                            echo \"N/A\";","                        }","                        echo \"</td>\";","            /*<td>*/    //echo \"<td class='room' data-target='#roomModal' data-toggle='modal'>\";","                        if(mysqli_num_rows($assignmentResult)>0){","                            $roomies=\"\";","                            $ids=\"\";","                            for($x=1;$x<=4;$x++){","                                $query=mysqli_query($conn,\"SELECT * from students WHERE studID=\".$row[\"stud$x\"]);","                                if($query&&mysqli_num_rows($query)>0){","                                $assoc=mysqli_fetch_assoc($query);","                                $roomies=$roomies.$assoc['fName'].\" \".$assoc['mName'].\" \".$assoc['lName'].\" | \";","                                $ids=$ids.$row[\"stud$x\"].\",\";","                                }","                                else{","                                    $roomies=$roomies.\"EMPTY | \";","                                    $ids=$ids.\",\";","                                }","                            }","                            $ids=$ids.$row['id'];","                            echo \"<td class='room' id='$ids' data-target='#roomModal' data-toggle='modal'>\";","                            echo substr($roomies, 0, strlen($roomies)-strlen(\" | \"));","                            echo \"</td>\";","                        }","                        else{","                            echo \"<td class='room' data-target='#roomModal' data-toggle='modal'>No Room</td>\";","                        }","                        ","                  ","           /* END */    echo \"</tr>\";","                    }","                }","                else","                    array_push($missingLetters, chr($letter));","            } ?>","            </tbody>","        </table>","    </div>","    <br/>","</div>","<script>","    function closestLetter(letter){","        var f=letter.toLowerCase();","        var b=letter.toLowerCase();","        var arr=<?php echo json_encode($missingLetters); ?>;","        for(var i=0; i<arr.letter; i++)","            arr[i]=arr[i].toLowerCase();","","        while( !(","            (!arr.includes(b) && b.charCodeAt() >=('a').charCodeAt()) ||","            (!arr.includes(f) && f.charCodeAt() <=('z').charCodeAt())","        ) ){","            b=String.fromCharCode(b.charCodeAt() - 1);","            f=String.fromCharCode(f.charCodeAt() + 1);","        }","        if( b.charCodeAt() >='a'.charCodeAt() && !arr.includes(b))","            return b;","        else if(f.charCodeAt() <='z'.charCodeAt() && !arr.includes(f))","            return f;","","        return \"students-link\";","    }","</script>"],"id":1}]]},"ace":{"folds":[],"scrolltop":2949,"scrollleft":0,"selection":{"start":{"row":230,"column":14},"end":{"row":230,"column":14},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":342,"state":"js-start","mode":"ace/mode/php"}},"timestamp":1559533109358,"hash":"a3559b36fb74a70156d8fa3b2b8bd5060541087e"}